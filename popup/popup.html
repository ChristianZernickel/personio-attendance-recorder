<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personio Attendance Recorder</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>Personio Attendance Recorder</h1>
      <p class="version">v0.1.0</p>
    </header>

    <!-- Status Section -->
    <section class="status-section">
      <div id="authStatus" class="status-badge">
        <span id="authStatusIcon">⏳</span>
        <span id="authStatusText">Prüfe Authentifizierung...</span>
      </div>
    </section>

    <!-- Profile Section -->
    <section class="profile-section">
      <div class="section-header">
        <h2>Arbeitszeitprofil</h2>
        <button id="toggleProfileEdit" class="btn btn-icon" title="Profil bearbeiten">✏️</button>
      </div>

      <!-- Profile Summary (shown by default) -->
      <div id="profileSummary" class="profile-summary">
        <div class="summary-item">
          <span class="summary-label">Instanz:</span>
          <span id="summaryInstance">-</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Mitarbeiter-ID:</span>
          <span id="summaryEmployeeId">-</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Arbeitstage:</span>
          <span id="summaryWorkdays">-</span>
        </div>
        <div class="summary-schedule" id="summarySchedule">
          <!-- Will be populated dynamically -->
        </div>
      </div>

      <!-- Profile Editor (hidden by default) -->
      <div id="profileEditor" class="profile-editor" style="display: none;">
        <div class="form-group">
          <label for="personioInstance">Personio Instanz:</label>
          <input type="text" id="personioInstance" placeholder="z.B. aoe-gmbh.app.personio.com">
          <small>Vollständige Domain ohne https://</small>
        </div>

        <div class="form-group">
          <label for="employeeId">Mitarbeiter-ID:</label>
          <input type="text" id="employeeId" placeholder="z.B. 13011272">
          <small>Ihre numerische Personio Mitarbeiter-ID</small>
        </div>

        <div class="form-group">
          <label for="timezone">Zeitzone:</label>
          <select id="timezone">
            <option value="Europe/Berlin" selected>Europe/Berlin</option>
            <option value="Europe/Vienna">Europe/Vienna</option>
            <option value="Europe/Zurich">Europe/Zurich</option>
          </select>
        </div>

        <div class="form-group">
          <label>Arbeitszeiten pro Wochentag:</label>
          <div class="weekday-schedule">
            <!-- Monday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="1" class="day-enabled" id="day1Enabled">
                <span class="day-name">Montag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day1WorkStart" value="08:00">
                <span>-</span>
                <input type="time" class="day-work-end" id="day1WorkEnd" value="17:00">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day1BreakStart" value="12:00">
                <span>-</span>
                <input type="time" class="day-break-end" id="day1BreakEnd" value="13:00">
              </div>
            </div>

            <!-- Tuesday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="2" class="day-enabled" id="day2Enabled">
                <span class="day-name">Dienstag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day2WorkStart" value="08:00">
                <span>-</span>
                <input type="time" class="day-work-end" id="day2WorkEnd" value="17:00">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day2BreakStart" value="12:00">
                <span>-</span>
                <input type="time" class="day-break-end" id="day2BreakEnd" value="13:00">
              </div>
            </div>

            <!-- Wednesday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="3" class="day-enabled" id="day3Enabled">
                <span class="day-name">Mittwoch</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day3WorkStart" value="08:00">
                <span>-</span>
                <input type="time" class="day-work-end" id="day3WorkEnd" value="17:00">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day3BreakStart" value="12:00">
                <span>-</span>
                <input type="time" class="day-break-end" id="day3BreakEnd" value="13:00">
              </div>
            </div>

            <!-- Thursday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="4" class="day-enabled" id="day4Enabled">
                <span class="day-name">Donnerstag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day4WorkStart" value="08:00">
                <span>-</span>
                <input type="time" class="day-work-end" id="day4WorkEnd" value="17:00">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day4BreakStart" value="12:00">
                <span>-</span>
                <input type="time" class="day-break-end" id="day4BreakEnd" value="13:00">
              </div>
            </div>

            <!-- Friday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="5" class="day-enabled" id="day5Enabled">
                <span class="day-name">Freitag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day5WorkStart" value="08:00">
                <span>-</span>
                <input type="time" class="day-work-end" id="day5WorkEnd" value="13:00">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day5BreakStart" value="12:00">
                <span>-</span>
                <input type="time" class="day-break-end" id="day5BreakEnd" value="12:30">
              </div>
            </div>

            <!-- Saturday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="6" class="day-enabled" id="day6Enabled">
                <span class="day-name">Samstag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day6WorkStart" value="08:00">
                <span>-</span>
                <input type="time" class="day-work-end" id="day6WorkEnd" value="17:00">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day6BreakStart" value="12:00">
                <span>-</span>
                <input type="time" class="day-break-end" id="day6BreakEnd" value="13:00">
              </div>
            </div>

            <!-- Sunday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="7" class="day-enabled" id="day7Enabled">
                <span class="day-name">Sonntag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day7WorkStart" value="08:00">
                <span>-</span>
                <input type="time" class="day-work-end" id="day7WorkEnd" value="17:00">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day7BreakStart" value="12:00">
                <span>-</span>
                <input type="time" class="day-break-end" id="day7BreakEnd" value="13:00">
              </div>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button id="saveProfile" class="btn btn-primary">Profil speichern</button>
          <button id="cancelEdit" class="btn btn-secondary">Abbrechen</button>
        </div>
      </div>
    </section>

    <!-- Action Section -->
    <section class="action-section">
      <h2>Zeiterfassung</h2>

      <div id="profileStatus" class="info-box">
        <p>Bitte zuerst Profil konfigurieren und speichern.</p>
      </div>

      <button id="startRecording" class="btn btn-primary" disabled>
        Zeiterfassung starten
      </button>
    </section>

    <!-- Progress Section -->
    <section id="progressSection" class="progress-section" style="display: none;">
      <h3>Fortschritt</h3>
      <div class="progress-bar">
        <div id="progressFill" class="progress-fill" style="width: 0%"></div>
      </div>
      <p id="progressText" class="progress-text">0 / 0</p>
      <div id="progressLog" class="progress-log"></div>
    </section>

    <!-- Result Section -->
    <section id="resultSection" class="result-section" style="display: none;">
      <h3>Ergebnis</h3>
      <div id="resultSummary" class="result-summary"></div>
      <div id="resultDetails" class="result-details"></div>
    </section>

    <!-- Footer -->
    <footer class="footer">
      <p>Made with ❤️ for Personio users</p>
    </footer>
  </div>

  <!-- Scripts -->
  <script src="../utils/helpers.js"></script>
  <script src="../services/auth-manager.js"></script>
  <script src="../services/api-client.js"></script>
  <script src="../services/timesheet-service.js"></script>
  <script src="../services/attendance-service.js"></script>
  <script src="../storage/storage-manager.js"></script>
  <script src="popup.js"></script>
</body>
</html>

