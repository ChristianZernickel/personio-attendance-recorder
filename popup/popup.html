<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Personio Attendance Recorder</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>Personio Attendance Recorder</h1>
      <p class="version">v0.2.0</p>
    </header>

    <!-- Status Section -->
    <section class="status-section">
      <div id="authStatus" class="status-badge">
        <span id="authStatusIcon">‚è≥</span>
        <span id="authStatusText">Pr√ºfe Authentifizierung...</span>
      </div>
    </section>

    <!-- Profile Section -->
    <section class="profile-section">
      <div class="section-header">
        <h2>Arbeitszeitprofil</h2>
        <button id="toggleProfileEdit" class="btn btn-icon" title="Profil bearbeiten">‚úèÔ∏è</button>
      </div>

      <!-- Profile Summary (shown by default) -->
      <div id="profileSummary" class="profile-summary">
        <div class="summary-item">
          <span class="summary-label">Instanz:</span>
          <span id="summaryInstance">-</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Mitarbeiter-ID:</span>
          <span id="summaryEmployeeId">-</span>
        </div>
        <div class="summary-item">
          <span class="summary-label">Arbeitstage:</span>
          <span id="summaryWorkdays">-</span>
        </div>
        <div class="summary-schedule" id="summarySchedule">
          <!-- Will be populated dynamically -->
        </div>
      </div>

      <!-- Profile Editor (hidden by default) -->
      <div id="profileEditor" class="profile-editor" style="display: none;">
        <div class="form-group">
          <label for="personioInstance">Personio Instanz:</label>
          <input type="text" id="personioInstance" placeholder="z.B. aoe-gmbh.app.personio.com">
          <small>Vollst√§ndige Domain ohne https://</small>
        </div>

        <div class="form-group">
          <label for="employeeId">Mitarbeiter-ID:</label>
          <input type="text" id="employeeId" placeholder="z.B. 13011272">
          <small>Ihre numerische Personio Mitarbeiter-ID</small>
        </div>

        <div class="form-group">
          <label for="timezone">Zeitzone:</label>
          <select id="timezone">
            <option value="Europe/Berlin" selected>Europe/Berlin</option>
            <option value="Europe/Vienna">Europe/Vienna</option>
            <option value="Europe/Zurich">Europe/Zurich</option>
          </select>
        </div>

        <div class="form-group">
          <label>Arbeitszeiten pro Wochentag:</label>
          <div class="weekday-schedule">
            <!-- Monday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="1" class="day-enabled" id="day1Enabled">
                <span class="day-name">Montag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day1WorkStart" value="08:00" aria-label="Montag Arbeitsbeginn">
                <span>-</span>
                <input type="time" class="day-work-end" id="day1WorkEnd" value="17:00" aria-label="Montag Arbeitsende">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day1BreakStart" value="12:00" aria-label="Montag Pausenbeginn">
                <span>-</span>
                <input type="time" class="day-break-end" id="day1BreakEnd" value="13:00" aria-label="Montag Pausenende">
              </div>
            </div>

            <!-- Tuesday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="2" class="day-enabled" id="day2Enabled">
                <span class="day-name">Dienstag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day2WorkStart" value="08:00" aria-label="Dienstag Arbeitsbeginn">
                <span>-</span>
                <input type="time" class="day-work-end" id="day2WorkEnd" value="17:00" aria-label="Dienstag Arbeitsende">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day2BreakStart" value="12:00" aria-label="Dienstag Pausenbeginn">
                <span>-</span>
                <input type="time" class="day-break-end" id="day2BreakEnd" value="13:00" aria-label="Dienstag Pausenende">
              </div>
            </div>

            <!-- Wednesday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="3" class="day-enabled" id="day3Enabled">
                <span class="day-name">Mittwoch</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day3WorkStart" value="08:00" aria-label="Mittwoch Arbeitsbeginn">
                <span>-</span>
                <input type="time" class="day-work-end" id="day3WorkEnd" value="17:00" aria-label="Mittwoch Arbeitsende">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day3BreakStart" value="12:00" aria-label="Mittwoch Pausenbeginn">
                <span>-</span>
                <input type="time" class="day-break-end" id="day3BreakEnd" value="13:00" aria-label="Mittwoch Pausenende">
              </div>
            </div>

            <!-- Thursday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="4" class="day-enabled" id="day4Enabled">
                <span class="day-name">Donnerstag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day4WorkStart" value="08:00" aria-label="Donnerstag Arbeitsbeginn">
                <span>-</span>
                <input type="time" class="day-work-end" id="day4WorkEnd" value="17:00" aria-label="Donnerstag Arbeitsende">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day4BreakStart" value="12:00" aria-label="Donnerstag Pausenbeginn">
                <span>-</span>
                <input type="time" class="day-break-end" id="day4BreakEnd" value="13:00" aria-label="Donnerstag Pausenende">
              </div>
            </div>

            <!-- Friday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="5" class="day-enabled" id="day5Enabled">
                <span class="day-name">Freitag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day5WorkStart" value="08:00" aria-label="Freitag Arbeitsbeginn">
                <span>-</span>
                <input type="time" class="day-work-end" id="day5WorkEnd" value="13:00" aria-label="Freitag Arbeitsende">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day5BreakStart" value="12:00" aria-label="Freitag Pausenbeginn">
                <span>-</span>
                <input type="time" class="day-break-end" id="day5BreakEnd" value="12:30" aria-label="Freitag Pausenende">
              </div>
            </div>

            <!-- Saturday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="6" class="day-enabled" id="day6Enabled">
                <span class="day-name">Samstag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day6WorkStart" value="08:00" aria-label="Samstag Arbeitsbeginn">
                <span>-</span>
                <input type="time" class="day-work-end" id="day6WorkEnd" value="17:00" aria-label="Samstag Arbeitsende">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day6BreakStart" value="12:00" aria-label="Samstag Pausenbeginn">
                <span>-</span>
                <input type="time" class="day-break-end" id="day6BreakEnd" value="13:00" aria-label="Samstag Pausenende">
              </div>
            </div>

            <!-- Sunday -->
            <div class="day-schedule">
              <label class="day-toggle">
                <input type="checkbox" value="7" class="day-enabled" id="day7Enabled">
                <span class="day-name">Sonntag</span>
              </label>
              <div class="day-times">
                <input type="time" class="day-work-start" id="day7WorkStart" value="08:00" aria-label="Sonntag Arbeitsbeginn">
                <span>-</span>
                <input type="time" class="day-work-end" id="day7WorkEnd" value="17:00" aria-label="Sonntag Arbeitsende">
                <span class="time-separator">Pause:</span>
                <input type="time" class="day-break-start" id="day7BreakStart" value="12:00" aria-label="Sonntag Pausenbeginn">
                <span>-</span>
                <input type="time" class="day-break-end" id="day7BreakEnd" value="13:00" aria-label="Sonntag Pausenende">
              </div>
            </div>
          </div>
        </div>

        <div class="button-group">
          <button id="saveProfile" class="btn btn-primary">Profil speichern</button>
        </div>
      </div>
    </section>

    <!-- Tab Navigation -->
    <section class="action-section">
      <div class="tab-navigation">
        <button id="tabProfile" class="tab-btn active">üìÖ Profil</button>
        <button id="tabImport" class="tab-btn">üì• Import</button>
      </div>

      <!-- Tab Content: Profile -->
      <div id="profileTab" class="tab-content active">
        <div id="profileStatus" class="info-box">
          <p>Bitte zuerst Profil konfigurieren und speichern.</p>
        </div>

        <button id="startRecording" class="btn btn-primary btn-large" disabled>
          Zeiterfassung starten
        </button>

        <!-- Progress Section (Profile) -->
        <div id="progressSection" class="progress-section" style="display: none;">
          <h3>Fortschritt</h3>
          <div class="progress-bar">
            <div id="progressFill" class="progress-fill"></div>
          </div>
          <p id="progressText" class="progress-text">0 / 0</p>
          <div id="progressLog" class="progress-log"></div>
        </div>

        <!-- Result Section (Profile) -->
        <div id="resultSection" class="result-section" style="display: none;">
          <h3>Ergebnis</h3>
          <div id="resultSummary" class="result-summary"></div>
          <div id="resultDetails" class="result-details"></div>
        </div>
      </div>

      <!-- Tab Content: Import -->
      <div id="importTab" class="tab-content">
        <div class="import-section">
          <h3>üì• Zeiten aus Datei importieren</h3>
          <p class="import-description">
            Importiere Arbeitszeiten aus einer JSON-Datei.
            Bereits eingetragene Tage werden automatisch √ºbersprungen.
          </p>

          <!-- Import Method Selection -->
          <div class="import-method-tabs">
            <button id="importMethodFile" class="import-method-btn active">üìÅ Datei</button>
            <button id="importMethodText" class="import-method-btn">üìù Text</button>
          </div>

          <!-- File Import -->
          <div id="importFileMethod" class="import-method-content">
            <div class="form-group">
              <label for="importFile" class="btn btn-secondary">
                üìÅ Datei ausw√§hlen...
              </label>
              <input type="file" id="importFile" accept=".json,application/json" style="display: none;">
            </div>
            <div id="fileInfo"></div>
          </div>

          <!-- Text Import -->
          <div id="importTextMethod" class="import-method-content" style="display: none;">
            <div class="form-group">
              <label for="importText">JSON einf√ºgen:</label>
              <textarea id="importText"
                        class="import-textarea"
                        placeholder='[{"id":1,"start":"20251114T080000Z","end":"20251114T120000Z","tags":["work"]},...]'
                        rows="10"></textarea>
              <small>F√ºgen Sie hier Ihre JSON-Daten ein</small>
            </div>
            <button id="parseImportText" class="btn btn-secondary">JSON validieren</button>
            <div id="textInfo"></div>
          </div>

          <!-- Import Button -->
          <button id="startImport" class="btn btn-primary btn-large" disabled>
            Import starten
          </button>

          <!-- Progress Section (Import) -->
          <div id="importProgressSection" class="progress-section" style="display: none;">
            <h3>Fortschritt</h3>
            <div class="progress-bar">
              <div id="importProgressFill" class="progress-fill"></div>
            </div>
            <p id="importProgressText" class="progress-text">0 / 0</p>
            <div id="importProgressLog" class="progress-log"></div>
          </div>

          <!-- Result Section (Import) -->
          <div id="importResultSection" class="result-section" style="display: none;">
            <h3>Ergebnis</h3>
            <div id="importResultSummary" class="result-summary"></div>
            <div id="importResultDetails" class="result-details"></div>
          </div>
        </div>
      </div>
    </section>
  </div>

  <!-- Scripts -->
  <script src="../utils/helpers.js"></script>
  <script src="../storage/storage-manager.js"></script>
  <script src="../services/auth-manager.js"></script>
  <script src="../services/api-client.js"></script>
  <script src="../services/timesheet-service.js"></script>
  <script src="../services/attendance-service.js"></script>
  <script src="../services/time-import-service.js"></script>
  <script src="../services/profile-service.js"></script>
  <script src="../services/ui-log-service.js"></script>
  <script src="../services/recording-workflow-service.js"></script>
  <script src="popup.js"></script>
</body>
</html>
